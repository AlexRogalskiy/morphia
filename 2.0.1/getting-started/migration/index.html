<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.67.1" />
    <meta name="description" content="">


    <link rel="icon" href="/2.0.1/images/favicon.png" type="image/png">

    <title>Migrating to 2.0 :: Morphia</title>

    
    <link href="/2.0.1/css/nucleus.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/fontawesome-all.min.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/hybrid.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/featherlight.min.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/perfect-scrollbar.min.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/auto-complete.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/atom-one-dark-reasonable.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/theme.css?1600804522" rel="stylesheet">
    <link href="/2.0.1/css/hugo-theme.css?1600804522" rel="stylesheet">
    

    <script src="/2.0.1/js/jquery-3.3.1.min.js?1600804522"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <link href="/2.0.1/css/java.css" rel="stylesheet">
<link href="/2.0.1/css/theme-green.css" rel="stylesheet">

<style>
    :root {
        --MAIN-TEXT-color:#004042;  
        --MAIN-TITLES-TEXT-color: #004042;  
        --MAIN-LINK-color:#006cbc;  
        --MAIN-LINK-HOVER-color:#3f6d2c;  
        --MAIN-ANCHOR-color: #599a3e;  

        --MENU-HEADER-BG-color:#004042;  
        --MENU-HEADER-BORDER-color:#6ca439;  

        --MENU-SEARCH-BG-color:#006264;  
        --MENU-SEARCH-BOX-color: #84c767;  
        --MENU-SEARCH-BOX-ICONS-color: #c7f7c4;  

        --MENU-SECTIONS-ACTIVE-BG-color:#1b211c;  
        --MENU-SECTIONS-BG-color:#222723;  
        --MENU-SECTIONS-LINK-color: #ccc;  
        --MENU-SECTIONS-LINK-HOVER-color: #e6e6e6;   
        --MENU-SECTION-ACTIVE-CATEGORY-color: #777;  
        --MENU-SECTION-ACTIVE-CATEGORY-BG-color: #f3f4eb;  

        --MENU-VISITED-color: #599a3e;  
        --MENU-SECTION-HR-color: #18211c;  
    }

    body {
        background-color: var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color);
        padding-top: 0;
    }

    h1 {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    strong {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    #top-bar-sticky-wrapper {
        visibility: hidden !important;
        min-height: 0;
    }

</style>

  </head>
  <body class="" data-url="/2.0.1/getting-started/migration/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/2.0.1">
    <img src="/2.0.1/images/logo.png" alt="Morphia Logo"/>
</a>
<span id="version-tag">Morphia 2.0.1</span>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/2.0.1/getting-started/" title="Getting Started" class="dd-item 
        parent
        
        
        ">
      <a href="/2.0.1/getting-started/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/getting-started/migration/" title="Migrating to 2.0" class="dd-item active">
        <a href="/2.0.1/getting-started/migration/">
        Migrating to 2.0
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/getting-started/quick-tour/" title="Quick Tour" class="dd-item ">
        <a href="/2.0.1/getting-started/quick-tour/">
        Quick Tour
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/2.0.1/guides/" title="Reference Guides" class="dd-item 
        
        
        
        ">
      <a href="/2.0.1/guides/">
          Reference Guides
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/annotations/" title="Annotations" class="dd-item ">
        <a href="/2.0.1/guides/annotations/">
        Annotations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/aggregation/" title="Aggregation" class="dd-item ">
        <a href="/2.0.1/guides/aggregation/">
        Aggregation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/configuration/" title="Configuration" class="dd-item ">
        <a href="/2.0.1/guides/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/indexing/" title="Indexing" class="dd-item ">
        <a href="/2.0.1/guides/indexing/">
        Indexing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/lifecyclemethods/" title="Life Cycle Methods" class="dd-item ">
        <a href="/2.0.1/guides/lifecyclemethods/">
        Life Cycle Methods
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/querying/" title="Querying" class="dd-item ">
        <a href="/2.0.1/guides/querying/">
        Querying
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/querying-old/" title="Querying (Deprecated)" class="dd-item ">
        <a href="/2.0.1/guides/querying-old/">
        Querying (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/references/" title="References" class="dd-item ">
        <a href="/2.0.1/guides/references/">
        References
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/schemavalidation/" title="Schema Validation" class="dd-item ">
        <a href="/2.0.1/guides/schemavalidation/">
        Schema Validation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/textsearch/" title="Text Search" class="dd-item ">
        <a href="/2.0.1/guides/textsearch/">
        Text Search
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/transactions/" title="Transactions" class="dd-item ">
        <a href="/2.0.1/guides/transactions/">
        Transactions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/updating/" title="Updating" class="dd-item ">
        <a href="/2.0.1/guides/updating/">
        Updating
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/updating-old/" title="Updating (Deprecated)" class="dd-item ">
        <a href="/2.0.1/guides/updating-old/">
        Updating (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="/2.0.1/javadoc"><i class='fas fa-book'></i> API Documentation</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/MorphiaOrg/morphia"><i class='fab fa-fw fa-github'></i> Source Code</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Migrating to 2.0 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Migrating to 2.0
            </h1>
          

        



<p>These are the major goals of the 2.0 release:</p>
<ol>
<li>Modernization of the implementation</li>
<li>Clean up and modernization of the API</li>
<li>Attempt to make the API more self-consistent.</li>
</ol>
<p>This release aims to make the API smaller, lighter, and more fluent.  The pre-2.0 deprecations are being removed and new deprecations
added to further improve the API and the developer experience.  As such there are a few things to note when upgrading.  If you find any
missing or unclear items please file an <a href="https://github.com/MorphiaOrg/morphia/issues">issue</a>.</p>
<ul>
<li>
<p><strong>Defaults Changes</strong></p>
<p>Default mapping options have been changed for a more modern, configurable feel.  In 1.6, the standard builder for <code>MapperOptions</code> was
<a href="https://morphia.dev/1.6.0/javadoc/dev/morphia/mapping/MapperOptions.html#builder()">deprecated</a> in favor of the
<a href="https://morphia.dev/1.6.0/javadoc/dev/morphia/mapping/MapperOptions.html#legacy()">legacy</a> method instead.  If you made this change
nothing should be different when upgrading.  However, if you did not or if you never explicitly configured your <code>Mapper</code> then you
will run in to some migration issues.</p>
<ul>
<li>The default discriminator is now <code>_t</code> rather than <code>className</code> with a value that is the simple name of the class name.  This is
configurable using <a href="https://morphia.dev/2.0.1/javadoc/dev/morphia/mapping/MapperOptions.Builder.html#discriminatorKey(java.lang.String)">MapperOptions.Builder.html#discriminatorKey()</a>
and <a href="https://morphia.dev/2.0.1/javadoc/dev/morphia/mapping/MapperOptions.Builder.html#discriminator(dev.morphia.mapping.DiscriminatorFunction)">MapperOptions.Builder.html#discriminator()</a>.
The latter allows you pass in an existing <a href="https://morphia.dev/2.0.1/javadoc/dev/morphia/mapping/DiscriminatorFunction.html">discriminator function</a>
or to supply your own custom function.</li>
<li>Collection mapping now defaults to the camel case form of the class&rsquo;s simple name.</li>
<li><code>@Entity</code> now defaults to using discriminator values when saving documents.</li>
</ul>
</li>
<li>
<p><code>@Embedded</code> is now only allowed on the embedded type and not fields using an embedded type.  If you wish to map a specific name to a
field  rather than using the field name, use <code>@Property</code> on that field.</p>
</li>
<li>
<p>Morphia&rsquo;s geojson objects have been deprecated.  Any use via the API will be transparently converted to the driver&rsquo;s native types but
applications should be updated to use those types directly.  Any use of those types as fields on entities will break as there will be no
codecs defined for those types.</p>
</li>
<li>
<p>Many methods on <code>Datastore</code> are being deprecated in favor of more fluent APIs with <code>Query</code> as the root entry point.  In most cases,
much of your code can remain as it is but with a slight rearrangement it can take advantage of the fluent API.  e.g., when performing an
update operation, this code:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>
    getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>SomeEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">equal</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Robert&#34;</span><span style="color:#f92672">),</span>
    getAds<span style="color:#f92672">().</span><span style="color:#a6e22e">createUpdateOperations</span><span style="color:#f92672">(</span>SomeEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">removeAll</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nicknames&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Shorty&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><p>becomes this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>SomeEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>eq<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Robert&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>pullAll<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;nicknames&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Shorty&#34;</span><span style="color:#f92672">))</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">();</span>
</code></pre></div><p>Update operators are defined on <a href="/2.0.1/javadoc/dev/morphia/query/experimental/updates/UpdateOperators
">UpdateOperators</a> and generally
match the &ldquo;dollar name&rdquo; as used by the server.  e.g. <code>UpdateOperators.inc()</code> is used for the <code>$inc</code> operation.</p>
<ul>
<li><code>Query#find()</code> is being replaced by <code>iterator()</code>.  This is because <code>Query</code> now implements the <code>Iterable</code> interface and can now be use
directly in enhanced for loops without the need to call an extra method to get an <code>Iterator</code>.  However, should any options need to be
passed in for executing the query, there is an overload on <code>iterator()</code> that takes a <code>FindOptions</code> parameter.  If you would rather pull
all results in to a <code>List</code>, there is a <code>toList()</code> defined on the <code>Iterable</code> returned by <code>iterator()</code>.</li>
<li>Some of the old <code>update()</code> methods made certain assumptions with <code>multi</code> update being the default.  In keeping with the change of the
server defaulting to single document updates, Morphia defaults to single document updates as well unless explicitly set to update
multiple documents.  See the <a href="https://docs.mongodb.com/manual/reference/method/db.collection.update/"><code>update()</code></a> documentation for details.</li>
<li>Iterable parameters have been changed to List.  Lists are easier to work with and <code>List.of()</code> makes creating them from arrays, e.g.,
trivial</li>
<li>Lifecycle events on nested types are only called when instances of those embedded types are being persisted.</li>
<li>Keys are no longer allowed as fields.  Use <a href="/2.0.1/javadoc/dev/morphia/annotations/Reference
"><code>@Reference</code></a> or
<a href="/2.0.1/javadoc/dev/morphia/mapping/experimental/MorphiaReference
"><code>MorphiaReference</code></a> instead.</li>
<li>Polymorphic queries across collections are not currently supported.  That is, if you have entities A and B each mapped to separate
collections, a query against type A will not automatically look in the collection mapped for B to find your entities.</li>
<li>The default option when calling <code>modify()</code> is to return the before state of the entity.  This is a change to the default behavior of
the old, deprecated methods which was to return the new state.  This brings Morphia&rsquo;s behavior inline with the server&rsquo;s.</li>
<li>Geo queries have been migrated to use the driver defined geospatial types.  All of the Morphia geo types and methods have been deprecated.</li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/2.0.1/js/clipboard.min.js?1600804522"></script>
    <script src="/2.0.1/js/perfect-scrollbar.min.js?1600804522"></script>
    <script src="/2.0.1/js/perfect-scrollbar.jquery.min.js?1600804522"></script>
    <script src="/2.0.1/js/jquery.sticky.js?1600804522"></script>
    <script src="/2.0.1/js/featherlight.min.js?1600804522"></script>
    <script src="/2.0.1/js/highlight.pack.js?1600804522"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/2.0.1/js/modernizr.custom-3.6.0.js?1600804522"></script>
    <script src="/2.0.1/js/learn.js?1600804522"></script>
    <script src="/2.0.1/js/hugo-learn.js?1600804522"></script>

    <link href="/2.0.1/mermaid/mermaid.css?1600804522" rel="stylesheet" />
    <script src="/2.0.1/mermaid/mermaid.js?1600804522"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

