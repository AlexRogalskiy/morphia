<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.67.1" />
    <meta name="description" content="">


    <link rel="icon" href="/2.0.1/images/favicon.png" type="image/png">

    <title>Querying (Deprecated) :: Morphia</title>

    
    <link href="/2.0.1/css/nucleus.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/fontawesome-all.min.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/hybrid.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/featherlight.min.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/perfect-scrollbar.min.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/auto-complete.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/atom-one-dark-reasonable.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/theme.css?1600809039" rel="stylesheet">
    <link href="/2.0.1/css/hugo-theme.css?1600809039" rel="stylesheet">
    

    <script src="/2.0.1/js/jquery-3.3.1.min.js?1600809039"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <link href="/2.0.1/css/java.css" rel="stylesheet">
<link href="/2.0.1/css/theme-green.css" rel="stylesheet">

<style>
    :root {
        --MAIN-TEXT-color:#004042;  
        --MAIN-TITLES-TEXT-color: #004042;  
        --MAIN-LINK-color:#006cbc;  
        --MAIN-LINK-HOVER-color:#3f6d2c;  
        --MAIN-ANCHOR-color: #599a3e;  

        --MENU-HEADER-BG-color:#004042;  
        --MENU-HEADER-BORDER-color:#6ca439;  

        --MENU-SEARCH-BG-color:#006264;  
        --MENU-SEARCH-BOX-color: #84c767;  
        --MENU-SEARCH-BOX-ICONS-color: #c7f7c4;  

        --MENU-SECTIONS-ACTIVE-BG-color:#1b211c;  
        --MENU-SECTIONS-BG-color:#222723;  
        --MENU-SECTIONS-LINK-color: #ccc;  
        --MENU-SECTIONS-LINK-HOVER-color: #e6e6e6;   
        --MENU-SECTION-ACTIVE-CATEGORY-color: #777;  
        --MENU-SECTION-ACTIVE-CATEGORY-BG-color: #f3f4eb;  

        --MENU-VISITED-color: #599a3e;  
        --MENU-SECTION-HR-color: #18211c;  
    }

    body {
        background-color: var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color);
        padding-top: 0;
    }

    h1 {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    strong {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    #top-bar-sticky-wrapper {
        visibility: hidden !important;
        min-height: 0;
    }

</style>

  </head>
  <body class="" data-url="/2.0.1/guides/querying-old/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/2.0.1">
    <img src="/2.0.1/images/logo.png" alt="Morphia Logo"/>
</a>
<span id="version-tag">Morphia 2.0.1</span>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/2.0.1/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/2.0.1/getting-started/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/getting-started/migration/" title="Migrating to 2.0" class="dd-item ">
        <a href="/2.0.1/getting-started/migration/">
        Migrating to 2.0
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/getting-started/quick-tour/" title="Quick Tour" class="dd-item ">
        <a href="/2.0.1/getting-started/quick-tour/">
        Quick Tour
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/2.0.1/guides/" title="Reference Guides" class="dd-item 
        parent
        
        
        ">
      <a href="/2.0.1/guides/">
          Reference Guides
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/annotations/" title="Annotations" class="dd-item ">
        <a href="/2.0.1/guides/annotations/">
        Annotations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/aggregation/" title="Aggregation" class="dd-item ">
        <a href="/2.0.1/guides/aggregation/">
        Aggregation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/configuration/" title="Configuration" class="dd-item ">
        <a href="/2.0.1/guides/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/indexing/" title="Indexing" class="dd-item ">
        <a href="/2.0.1/guides/indexing/">
        Indexing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/lifecyclemethods/" title="Life Cycle Methods" class="dd-item ">
        <a href="/2.0.1/guides/lifecyclemethods/">
        Life Cycle Methods
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/querying/" title="Querying" class="dd-item ">
        <a href="/2.0.1/guides/querying/">
        Querying
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/querying-old/" title="Querying (Deprecated)" class="dd-item active">
        <a href="/2.0.1/guides/querying-old/">
        Querying (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/references/" title="References" class="dd-item ">
        <a href="/2.0.1/guides/references/">
        References
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/schemavalidation/" title="Schema Validation" class="dd-item ">
        <a href="/2.0.1/guides/schemavalidation/">
        Schema Validation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/textsearch/" title="Text Search" class="dd-item ">
        <a href="/2.0.1/guides/textsearch/">
        Text Search
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/transactions/" title="Transactions" class="dd-item ">
        <a href="/2.0.1/guides/transactions/">
        Transactions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/updating/" title="Updating" class="dd-item ">
        <a href="/2.0.1/guides/updating/">
        Updating
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.1/guides/updating-old/" title="Updating (Deprecated)" class="dd-item ">
        <a href="/2.0.1/guides/updating-old/">
        Updating (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="/2.0.1/javadoc"><i class='fas fa-book'></i> API Documentation</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/MorphiaOrg/morphia"><i class='fab fa-fw fa-github'></i> Source Code</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Querying (Deprecated) 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#creating-a-query">Creating a Query</a>
      <ul>
        <li><a href="#filter"><code>filter()</code></a></li>
        <li><a href="#field"><code>field()</code></a></li>
      </ul>
    </li>
    <li><a href="#complex-queries">Complex Queries</a></li>
    <li><a href="#text-searching">Text Searching</a></li>
    <li><a href="#other-query-options">Other Query Options</a>
      <ul>
        <li><a href="#projections">Projections</a></li>
        <li><a href="#limiting-and-skipping">Limiting and Skipping</a></li>
        <li><a href="#ordering">Ordering</a></li>
        <li><a href="#tailable-cursors">Tailable Cursors</a></li>
        <li><a href="#raw-querying">Raw Querying</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Querying (Deprecated)
            </h1>
          

        




<div class="notices warning" ><p>This page describes the older approach to querying.  While this older API is still supported, efforts should be made to update to the new
API as outlined in the other <a href="/2.0.1/guides/querying/">querying</a> guide.  This old API is active using the
<a href="/2.0.1/guides/configuration/#legacy">legacy configuration</a>.  The new API will attempt to redirect most calls to use the new
<a href="/2.0.1/javadoc/dev/morphia/query/experimental/filters/Filters">Filters</a> based approach.</p>
<p>Note that at this time complex queries using <code>and</code> or <code>or</code> clauses can not be correctly transparently translated and will require manual
effort to update to the new API.</p>
</div>

<p>Morphia offers a fluent API with which to build up a query and map the results back to instances of your entity classes.  It attempts
to provide as much type safety and validation as possible.  To this end, Morphia offers the <code>Query&lt;T&gt;</code> class which can be parameterized to
the type of your entity.</p>
<h2 id="creating-a-query">Creating a Query</h2>
<p>The <code>Datastore</code> is the key class when using Morphia.  Virtually all operations begin with the <code>Datastore</code>.  To create the <code>Query</code>, we
invoke the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Query<span style="color:#f92672">&lt;</span>Product<span style="color:#f92672">&gt;</span> query <span style="color:#f92672">=</span> datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span>Product<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><p><code>createQuery()</code> returns an instance of <code>Query</code> with which we can build a query.</p>
<h3 id="filter"><code>filter()</code></h3>
<p>The first method of interest is <code>filter()</code>.  This method takes two values: a condition string and a value.  The <code>value</code> parameter is, of
course, the value to use when applying the <code>condition</code> clause.  The <code>condition</code> parameter is a bit more complicated.  At its simplest,
the condition is just a field name.  In this case, the condition is assumed to be an <a href="http://docs.mongodb.org/manual/reference/operator/query/eq/
">equality</a> check.  There is a slightly more complicated variant, however.</p>
<p>The <code>condition</code> value can also contain an operator.  For example, to compare a numeric field against a value, you might write something
like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">query<span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;price &gt;=&#34;</span><span style="color:#f92672">,</span> 1000<span style="color:#f92672">);</span>
</code></pre></div><p>In this case, we&rsquo;re instructing Morphia to add a filter using <a href="http://docs.mongodb.org/manual/reference/operator/query/gte/
">$gte</a>.  This would result
in a query that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{ <span style="color:#a6e22e">price</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">$gte</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span> } }
</code></pre></div><p>The list of supported filter operations can be found in the <a href="https://github.com/MorphiaOrg/morphia/blob/r2.0.1/morphia/src/main/java/dev/morphia/query/FilterOperator.java
">FilterOperator</a> class.</p>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Alias</th>
</tr>
</thead>
<tbody>
<tr>
<td>$center</td>
<td></td>
</tr>
<tr>
<td>$centerSphere</td>
<td></td>
</tr>
<tr>
<td>$box</td>
<td></td>
</tr>
<tr>
<td>$eq</td>
<td>=, ==</td>
</tr>
<tr>
<td>$ne</td>
<td>!=, &lt;&gt;</td>
</tr>
<tr>
<td>$gt</td>
<td>&gt;</td>
</tr>
<tr>
<td>$gte</td>
<td>&gt;=</td>
</tr>
<tr>
<td>$lt</td>
<td>&lt;</td>
</tr>
<tr>
<td>$lte</td>
<td>&lt;=</td>
</tr>
<tr>
<td>$exists</td>
<td>exists</td>
</tr>
<tr>
<td>$type</td>
<td>type</td>
</tr>
<tr>
<td>$not</td>
<td></td>
</tr>
<tr>
<td>$mod</td>
<td>mod</td>
</tr>
<tr>
<td>$size</td>
<td>size</td>
</tr>
<tr>
<td>$in</td>
<td>in</td>
</tr>
<tr>
<td>$nin</td>
<td>nin</td>
</tr>
<tr>
<td>$all</td>
<td>all</td>
</tr>
<tr>
<td>$elemMatch</td>
<td>elem, elemMatch</td>
</tr>
<tr>
<td>$where</td>
<td></td>
</tr>
<tr>
<td>$near</td>
<td>near</td>
</tr>
<tr>
<td>$nearSphere</td>
<td></td>
</tr>
<tr>
<td>$within (deprecated replaced by $geoWithin)</td>
<td>within</td>
</tr>
<tr>
<td>$geoNear</td>
<td>geoNear</td>
</tr>
<tr>
<td>$geoWithin</td>
<td>geoWithin</td>
</tr>
<tr>
<td>$geoIntersects</td>
<td>geoIntersects</td>
</tr>
</tbody>
</table>
<p>Each filter operator can either be referenced by its MongoDB &ldquo;dollar operator&rdquo; or by the aliases listed afterward.  For example, with
the equal operator, you can use the canonical <code>$eq</code> operator as you would when building a query in the shell or you could opt to use
either the <code>=</code> or <code>==</code> aliases which might feel a little more natural to use than the dollar operators.</p>
<h3 id="field"><code>field()</code></h3>
<p>For those who would prefer more compile time validation of their queries, there is <code>field()</code>.  This method takes only the field name and
returns an instance of a <a href="https://github.com/MorphiaOrg/morphia/blob/r2.0.1/morphia/src/main/java/dev/morphia/query/FieldEnd.java
">class</a> providing methods with which
to define your filters.  This approach is slightly more verbose but can be validated by the compiler to a much greater degree than
<code>filter()</code> can be.  To perform the same query as above, you&rsquo;d write this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">query<span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;price&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">greaterThanOrEq</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>
</code></pre></div><p>This results in the exact same query as the <code>filter()</code> version but has the advantage that any typo in the operation name (method in this
case) would easily be caught by an IDE or compiler.  Which version you use is largely a question of preference.</p>

<div class="notices tip" ><p>Regardless of the approach used, the field name given can be either the Java field name or the document field name as defined by the
<a href="/2.0.1/javadoc/dev/morphia/annotations/Property"><code>@Property</code></a> annotation on the field.  Morphia will normalize the name and validate the name such that a query with a bad field name will
result in an error.</p>
</div>

<h2 id="complex-queries">Complex Queries</h2>
<p>Of course, queries are usually more complex than single field comparisons.  Morphia offers both <code>and()</code> and <code>or()</code> to build up more
complex queries.  An <code>and</code> query might look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">q<span style="color:#f92672">.</span><span style="color:#a6e22e">and</span><span style="color:#f92672">(</span>
    q<span style="color:#f92672">.</span><span style="color:#a6e22e">criteria</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;width&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">equal</span><span style="color:#f92672">(</span>10<span style="color:#f92672">),</span>
    q<span style="color:#f92672">.</span><span style="color:#a6e22e">criteria</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;height&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">equal</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
<span style="color:#f92672">);</span>
</code></pre></div><p>An <code>or</code> clause looks exactly the same except for using <code>or()</code> instead of <code>and()</code>, of course.  For these clauses we use the <code>criteria()</code>
method instead of <code>field()</code> but it is used in much the same fashion.  <code>and()</code> and <code>or()</code> take a [<code>varargs</code>](<a href="https://docs.oracle">https://docs.oracle</a>
.com/javase/8/docs/technotes/guides/language/varargs.html) parameter of type <code>Criteria</code> so you can include as many filters as necessary.
If all you need is an <code>and</code> clause, you don&rsquo;t need an explicit call to <code>and()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span>UserLocation<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">lessThan</span><span style="color:#f92672">(</span>5<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;y&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">greaterThan</span><span style="color:#f92672">(</span>4<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;z&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">greaterThan</span><span style="color:#f92672">(</span>10<span style="color:#f92672">);</span>
</code></pre></div><p>This generates an implicit <code>and</code> across the field comparisons.</p>
<h2 id="text-searching">Text Searching</h2>
<p>Morphia also supports MongoDB&rsquo;s text search capabilities.  In order to execute a text search against a collection, the collection must
have a <a href="http://docs.mongodb.org/manual//core/index-text/
">text index</a> defined first.  Using Morphia that definition would look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Indexes</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Index</span><span style="color:#f92672">(</span>fields <span style="color:#f92672">=</span> <span style="color:#a6e22e">@Field</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$**&#34;</span><span style="color:#f92672">,</span> type <span style="color:#f92672">=</span> IndexType<span style="color:#f92672">.</span><span style="color:#a6e22e">TEXT</span><span style="color:#f92672">)))</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Greeting</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Id</span>
    <span style="color:#66d9ef">private</span> ObjectId id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String value<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String language<span style="color:#f92672">;</span>

    <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The <code>$**</code> value tells MongoDB to create a text index on all the text fields in a document.  A more targeted index can be created, if
desired, by explicitly listing which fields to index.  Once the index is defined, we can start querying against it like this <a href="https://github.com/MorphiaOrg/morphia/blob/r2.0.1/morphia/src/test/java/dev/morphia/query/TestTextSearching.java
">test</a> does:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">morphia<span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>Greeting<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">ensureIndexes</span><span style="color:#f92672">();</span>

datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">save</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;good morning&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;english&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;good afternoon&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;english&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;good night&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;english&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;good riddance&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;english&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;guten Morgen&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;german&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;guten Tag&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;german&#34;</span><span style="color:#f92672">)),</span>
    <span style="color:#66d9ef">new</span> Greeting<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;gute Nacht&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;german&#34;</span><span style="color:#f92672">));</span>

List<span style="color:#f92672">&lt;</span>Greeting<span style="color:#f92672">&gt;</span> good <span style="color:#f92672">=</span> datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span>Greeting<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
                             <span style="color:#f92672">.</span><span style="color:#a6e22e">search</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;good&#34;</span><span style="color:#f92672">)</span>
                             <span style="color:#f92672">.</span><span style="color:#a6e22e">order</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;_id&#34;</span><span style="color:#f92672">)</span>
                             <span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">();</span>
Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">assertEquals</span><span style="color:#f92672">(</span>4<span style="color:#f92672">,</span> good<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
</code></pre></div><p>As you can see here, we create <code>Greeting</code> objects for multiple languages.  In our test query, we&rsquo;re looking for occurrences of the word
&ldquo;good&rdquo; in any document.  We created four such documents and our query returns exactly those four.</p>
<h2 id="other-query-options">Other Query Options</h2>
<p>There is more to querying than simply filtering against different document values.  Listed below are some of the options for modifying
the query results in different ways.</p>
<h3 id="projections">Projections</h3>
<p><a href="http://docs.mongodb.org/manual/tutorial/project-fields-from-query-results/
">Projections</a> allow you to return only a subset of the fields in a
document.  This is useful when you need to only return a smaller view of a larger object.  Borrowing from the <a href="https://github.com/MorphiaOrg/morphia/blob/r2.0.1/morphia/src/test/java/dev/morphia/TestQuery.java
">unit tests</a>, this is an example of this feature in action:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ContainsRenamedFields user <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ContainsRenamedFields<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Frank&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Zappa&#34;</span><span style="color:#f92672">);</span>
getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">save</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>

ContainsRenamedFields found <span style="color:#f92672">=</span> getDs<span style="color:#f92672">()</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>ContainsRenamedFields<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">project</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;first_name&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">assertNotNull</span><span style="color:#f92672">(</span>found<span style="color:#f92672">.</span><span style="color:#a6e22e">firstName</span><span style="color:#f92672">);</span>
Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">assertNull</span><span style="color:#f92672">(</span>found<span style="color:#f92672">.</span><span style="color:#a6e22e">lastName</span><span style="color:#f92672">);</span>

found <span style="color:#f92672">=</span> getDs<span style="color:#f92672">()</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>ContainsRenamedFields<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">project</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;firstName&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">assertNotNull</span><span style="color:#f92672">(</span>found<span style="color:#f92672">.</span><span style="color:#a6e22e">firstName</span><span style="color:#f92672">);</span>
Assert<span style="color:#f92672">.</span><span style="color:#a6e22e">assertNull</span><span style="color:#f92672">(</span>found<span style="color:#f92672">.</span><span style="color:#a6e22e">lastName</span><span style="color:#f92672">);</span>
</code></pre></div><p>As you can see here, we&rsquo;re saving this entity with a first and last name but our query only returns the first name (and the _id value) in
the returned instance of our type.  It&rsquo;s also worth noting that this project works with both the mapped document field name
<code>&quot;first_name&quot;</code> and the Java field name <code>&quot;firstName&quot;</code>.</p>
<p>The boolean value passed in instructs Morphia to either include (<code>true</code>) or exclude (<code>false</code>) the field.  It is not currently possible to list both inclusions and exclusions in one query.</p>

<div class="notices warn" ><p>While projections can be a nice performance win in some cases, it&rsquo;s important to note that this object can not be safely saved back to
MongoDB.  Any fields in the existing document in the database that are missing from the entity will be removed if this entity is
saved. For example, in the example above if <code>found</code> is saved back to MongoDB, the <code>last_name</code> field that currently exists in the database
for this entity will be removed.  To save such instances back consider using <a href="/2.0.1/javadoc/dev/morphia/Datastore#merge-T-"><code>Datastore#merge(T)</code></a></p>
</div>

<h3 id="limiting-and-skipping">Limiting and Skipping</h3>
<p>Pagination of query results is often done as a combination of skips and limits.  Morphia offers <code>Query.limit(int)</code> and <code>Query.offset(int)</code>
for these cases.  An example of these methods in action would look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore<span style="color:#f92672">.</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span>Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FindOptions<span style="color:#f92672">()</span>
	    <span style="color:#f92672">.</span><span style="color:#a6e22e">offset</span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
	    <span style="color:#f92672">.</span><span style="color:#a6e22e">limit</span><span style="color:#f92672">(</span>10<span style="color:#f92672">))</span>
</code></pre></div><p>This query will skip the first element and take up to the next 10 items found by the query.  There&rsquo;s a caveat to using skip/limit for
pagination, however.  See the <a href="http://docs.mongodb.org/manual/reference/method/cursor.skip
">skip</a> documentation for more detail.</p>
<h3 id="ordering">Ordering</h3>
<p>Ordering the results of a query is done via <a href="/javadoc/dev/morphia/query/Query.html#order-java.lang.String-"><code>Query.order(String)</code></a>
.  The javadoc has complete examples but this String consists of a list of comma delimited fields to order by.  To reverse the sort order
for a particular field simply prefix that field with a <code>-</code>.  For example, to sort by age (youngest to oldest) and then income (highest
to lowest), you would use this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">query<span style="color:#f92672">.</span><span style="color:#a6e22e">order</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;age,-income&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><h3 id="tailable-cursors">Tailable Cursors</h3>
<p>If you have a <a href="http://docs.mongodb.org/manual/core/capped-collections/
">capped collection</a> it&rsquo;s possible to &ldquo;tail&rdquo; a query so that when new documents
are added to the collection that match your query, they&rsquo;ll be returned by the <a href="http://docs.mongodb.org/manual/reference/glossary/#term-tailable-cursor
">tailable cursor</a>.  An example of this feature in action can be found in the <a href="https://github.com/MorphiaOrg/morphia/blob/r2.0.1/morphia/src/test/java/dev/morphia/TestQuery.java
">unit tests</a> in the <code>testTailableCursors()</code> test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getMorphia<span style="color:#f92672">().</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>CappedPic<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">ensureCaps</span><span style="color:#f92672">();</span>                                                          <span style="color:#75715e">// #1
</span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> Query<span style="color:#f92672">&lt;</span>CappedPic<span style="color:#f92672">&gt;</span> query <span style="color:#f92672">=</span> getDs<span style="color:#f92672">().</span><span style="color:#a6e22e">createQuery</span><span style="color:#f92672">(</span>CappedPic<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
<span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>CappedPic<span style="color:#f92672">&gt;</span> found <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>CappedPic<span style="color:#f92672">&gt;();</span>

<span style="color:#66d9ef">final</span> Iterator<span style="color:#f92672">&lt;</span>CappedPic<span style="color:#f92672">&gt;</span> tail <span style="color:#f92672">=</span> query
	<span style="color:#f92672">.</span><span style="color:#a6e22e">fetch</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FindOptions<span style="color:#f92672">()</span>
		<span style="color:#f92672">.</span><span style="color:#a6e22e">cursorType</span><span style="color:#f92672">(</span>CursorType<span style="color:#f92672">.</span><span style="color:#a6e22e">Tailable</span><span style="color:#f92672">));</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>found<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
	found<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tail<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">());</span>                                                    <span style="color:#75715e">// #2
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>There are two things to note about this code sample:</p>
<ol>
<li>This tells Morphia to make sure that any entity <a href="/2.0.1/guides/annotations/#entity">configured</a> to use a capped
collection has its collection created correctly.  If the collection already exists and is not capped, you will have to manually
<a href="http://docs.mongodb.org/manual/core/capped-collections/#convert-a-collection-to-capped
">update</a> your collection to be a capped collection.</li>
<li>Since this <code>Iterator</code> is backed by a tailable cursor, <code>hasNext()</code> and <code>next()</code> will block until a new item is found.  In this
version of the unit test, we tail the cursor waiting to pull out objects until we have 10 of them and then proceed with the rest of the
application.</li>
</ol>
<h3 id="raw-querying">Raw Querying</h3>
<p>You can use Morphia to map queries you might have already written using the raw Java API against your objects, or to access features which are not yet present in Morphia.</p>
<p>For example:</p>
<pre><code>Document query = new Document()
	.append(&quot;albums&quot;,
            new Document(&quot;$elemMatch&quot;,
                    new Document(&quot;$and&quot;, new Document[] {
                        new Document(&quot;albumId&quot;, albumDto.getAlbumId()),
                        new Document(&quot;album&quot;,
                            new Document(&quot;$exists&quot;, false))})));

Artist result = datastore.createQuery(Artist.class, query).get();
</code></pre>

<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/2.0.1/js/clipboard.min.js?1600809039"></script>
    <script src="/2.0.1/js/perfect-scrollbar.min.js?1600809039"></script>
    <script src="/2.0.1/js/perfect-scrollbar.jquery.min.js?1600809039"></script>
    <script src="/2.0.1/js/jquery.sticky.js?1600809039"></script>
    <script src="/2.0.1/js/featherlight.min.js?1600809039"></script>
    <script src="/2.0.1/js/highlight.pack.js?1600809039"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/2.0.1/js/modernizr.custom-3.6.0.js?1600809039"></script>
    <script src="/2.0.1/js/learn.js?1600809039"></script>
    <script src="/2.0.1/js/hugo-learn.js?1600809039"></script>

    <link href="/2.0.1/mermaid/mermaid.css?1600809039" rel="stylesheet" />
    <script src="/2.0.1/mermaid/mermaid.js?1600809039"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

