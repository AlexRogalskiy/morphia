<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.67.1" />
    <meta name="description" content="">


    <link rel="icon" href="/2.0.2/images/favicon.png" type="image/png">

    <title>Updating :: Morphia</title>

    
    <link href="/2.0.2/css/nucleus.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/fontawesome-all.min.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/hybrid.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/featherlight.min.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/perfect-scrollbar.min.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/auto-complete.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/atom-one-dark-reasonable.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/theme.css?1606080948" rel="stylesheet">
    <link href="/2.0.2/css/hugo-theme.css?1606080948" rel="stylesheet">
    

    <script src="/2.0.2/js/jquery-3.3.1.min.js?1606080948"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    <link href="/2.0.2/css/java.css" rel="stylesheet">
<link href="/2.0.2/css/theme-green.css" rel="stylesheet">

<style>
    :root {
        --MAIN-TEXT-color:#004042;  
        --MAIN-TITLES-TEXT-color: #004042;  
        --MAIN-LINK-color:#006cbc;  
        --MAIN-LINK-HOVER-color:#3f6d2c;  
        --MAIN-ANCHOR-color: #599a3e;  

        --MENU-HEADER-BG-color:#004042;  
        --MENU-HEADER-BORDER-color:#6ca439;  

        --MENU-SEARCH-BG-color:#006264;  
        --MENU-SEARCH-BOX-color: #84c767;  
        --MENU-SEARCH-BOX-ICONS-color: #c7f7c4;  

        --MENU-SECTIONS-ACTIVE-BG-color:#1b211c;  
        --MENU-SECTIONS-BG-color:#222723;  
        --MENU-SECTIONS-LINK-color: #ccc;  
        --MENU-SECTIONS-LINK-HOVER-color: #e6e6e6;   
        --MENU-SECTION-ACTIVE-CATEGORY-color: #777;  
        --MENU-SECTION-ACTIVE-CATEGORY-BG-color: #f3f4eb;  

        --MENU-VISITED-color: #599a3e;  
        --MENU-SECTION-HR-color: #18211c;  
    }

    body {
        background-color: var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color);
        padding-top: 0;
    }

    h1 {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    strong {
        color: var(--MAIN-TITLES-TEXT-color) !important;
    }

    #top-bar-sticky-wrapper {
        visibility: hidden !important;
        min-height: 0;
    }

</style>

  </head>
  <body class="" data-url="/2.0.2/guides/updating/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/2.0.2">
    <img src="/2.0.2/images/logo.png" alt="Morphia Logo"/>
</a>
<span id="version-tag">Morphia 2.0.2</span>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/2.0.2/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/2.0.2/getting-started/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/getting-started/migration/" title="Migrating to 2.0" class="dd-item ">
        <a href="/2.0.2/getting-started/migration/">
        Migrating to 2.0
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/getting-started/quick-tour/" title="Quick Tour" class="dd-item ">
        <a href="/2.0.2/getting-started/quick-tour/">
        Quick Tour
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/2.0.2/guides/" title="Reference Guides" class="dd-item 
        parent
        
        
        ">
      <a href="/2.0.2/guides/">
          Reference Guides
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/annotations/" title="Annotations" class="dd-item ">
        <a href="/2.0.2/guides/annotations/">
        Annotations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/aggregation/" title="Aggregation" class="dd-item ">
        <a href="/2.0.2/guides/aggregation/">
        Aggregation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/configuration/" title="Configuration" class="dd-item ">
        <a href="/2.0.2/guides/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/indexing/" title="Indexing" class="dd-item ">
        <a href="/2.0.2/guides/indexing/">
        Indexing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/lifecyclemethods/" title="Life Cycle Methods" class="dd-item ">
        <a href="/2.0.2/guides/lifecyclemethods/">
        Life Cycle Methods
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/querying/" title="Querying" class="dd-item ">
        <a href="/2.0.2/guides/querying/">
        Querying
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/querying-old/" title="Querying (Deprecated)" class="dd-item ">
        <a href="/2.0.2/guides/querying-old/">
        Querying (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/references/" title="References" class="dd-item ">
        <a href="/2.0.2/guides/references/">
        References
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/schemavalidation/" title="Schema Validation" class="dd-item ">
        <a href="/2.0.2/guides/schemavalidation/">
        Schema Validation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/textsearch/" title="Text Search" class="dd-item ">
        <a href="/2.0.2/guides/textsearch/">
        Text Search
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/transactions/" title="Transactions" class="dd-item ">
        <a href="/2.0.2/guides/transactions/">
        Transactions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/updating/" title="Updating" class="dd-item active">
        <a href="/2.0.2/guides/updating/">
        Updating
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/2.0.2/guides/updating-old/" title="Updating (Deprecated)" class="dd-item ">
        <a href="/2.0.2/guides/updating-old/">
        Updating (Deprecated)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="/2.0.2/javadoc"><i class='fas fa-book'></i> API Documentation</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/MorphiaOrg/morphia"><i class='fab fa-fw fa-github'></i> Source Code</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Updating 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#setunset">set()/unset()</a></li>
      </ul>
    </li>
    <li><a href="#multiple-updates">Multiple Updates</a></li>
    <li><a href="#upserts">Upserts</a></li>
    <li><a href="#checking-results">Checking results</a></li>
    <li><a href="#returning-the-updated-entity">Returning the updated entity</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Updating
            </h1>
          

        



<p>Updates in 2.0, are issued off of a <code>Query</code> instance in contrast to the <a href="updates-old.md">old approach</a> of using <code>Datastore#update()</code> in
previous versions.  These update operations are executed on the server without pulling any documents in to your application.  Update
operations are defined using a set of functions as  defined on
<a href="/2.0.2/javadoc/dev/morphia/query/experimental/updates/UpdateOperators
">UpdateOperators</a>  In our examples, we&rsquo;ll be using the
following model:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Entity</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hotels&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hotel</span>
<span style="color:#f92672">{</span>
   <span style="color:#a6e22e">@Id</span>
   <span style="color:#66d9ef">private</span> ObjectId id<span style="color:#f92672">;</span>

   <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> stars<span style="color:#f92672">;</span>

   <span style="color:#a6e22e">@Embedded</span>
   <span style="color:#66d9ef">private</span> Address address<span style="color:#f92672">;</span>

   List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> roomNumbers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;();</span>

   <span style="color:#75715e">// ... getters and setters
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Embedded</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Address</span>
<span style="color:#f92672">{</span>
   <span style="color:#66d9ef">private</span> String street<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> String city<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> String postalCode<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> String country<span style="color:#f92672">;</span>

   <span style="color:#75715e">// ... getters and setters
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h3 id="setunset">set()/unset()</h3>
<p>To change the name of the hotel, one would use something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>UpdateOperators<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Fairmont Chateau Laurier&#34;</span><span style="color:#f92672">))</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">();</span>
</code></pre></div><p>The <code>execute()</code> can optionally take <a href="/2.0.2/javadoc/dev/morphia/UpdateOptions
">UpdateOptions</a> if there are any options you might want
to apply to your update statement.</p>
<p>Embedded documents are updated the same way.  To change the name of the city in the address, one would use something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>UpdateOperators<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;address.city&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Ottawa&#34;</span><span style="color:#f92672">))</span>
    execute<span style="color:#f92672">();</span>
</code></pre></div><p>Values can also be removed from documents as shown below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">(</span>UpdateOperators<span style="color:#f92672">.</span><span style="color:#a6e22e">unset</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">))</span>
    execute<span style="color:#f92672">();</span>
</code></pre></div><p>After this update, the name of the hotel would be <code>null</code> when the entity is loaded.</p>
<h2 id="multiple-updates">Multiple Updates</h2>
<p>By default, an update operation will only update the first document matching the query.  This behavior can be modified via the optional
<a href="/2.0.2/javadoc/dev/morphia/UpdateOptions
">UpdateOptions</a> parameter on <code>execute()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">inc</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;stars&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> UpdateOptions<span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">multi</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">));</span>
</code></pre></div><h2 id="upserts">Upserts</h2>
<p>In some cases, updates are issued against a query that might not match any documents.  In these cases, it&rsquo;s often fine for those updates
to simply pass with no effect.  In other cases, it&rsquo;s desirable to create an initial document matching the query parameters.  Examples of
this might include user high scores, e.g.  In cases like this, we have the option to use an upsert:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>gt<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;stars&#34;</span><span style="color:#f92672">,</span> 100<span style="color:#f92672">))</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> UpdateOptions<span style="color:#f92672">()</span>
                     <span style="color:#f92672">.</span><span style="color:#a6e22e">upsert</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">));</span>  

<span style="color:#75715e">// creates { &#34;_id&#34; : ObjectId(&#34;4c60629d2f1200000000161d&#34;), &#34;stars&#34; : 50 }
</span></code></pre></div><h2 id="checking-results">Checking results</h2>
<p>In all this one thing we haven&rsquo;t really looked at is how to verify the results of an update.  The <code>execute()</code> method returns an instance of
<code>com.mongodb.client.result.UpdateResult</code>.  Using this class, you can get specific numbers from the update operation as well as any
generated ID as the result of an upsert.</p>
<h2 id="returning-the-updated-entity">Returning the updated entity</h2>
<p>There are times when a document needs to be updated and also fetched from the database.  In the server documentation, this is referred to
as <a href="http://docs.mongodb.org/manual/reference/method/db.collection.findAndModify/
"><code>findAndModify</code></a>.  In Morphia, this functionality is exposed
through the <a href="/2.0.2/javadoc/dev/morphia/query/Query#modify(dev.morphia.query.experimental.updates.UpdateOperator, dev.morphia.query.experimental.updates.UpdateOperator...)
">Query#modify()</a>
method.  With this method, you can choose to return the updated entity in either the state before or after the update.  The default is
to return the entity in the <em>after</em> state.  This can be changed by passing in a <code>ModifyOptions</code> reference to the operation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">datastore
    <span style="color:#f92672">.</span><span style="color:#a6e22e">find</span><span style="color:#f92672">(</span>Hotel<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">modify</span><span style="color:#f92672">(</span>UpdateOperators<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;address.city&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Ottawa&#34;</span><span style="color:#f92672">))</span>
    execute<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ModifyOptions<span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">returnDocument</span><span style="color:#f92672">(</span>ReturnDocument<span style="color:#f92672">.</span><span style="color:#a6e22e">BEFORE</span><span style="color:#f92672">));</span>
</code></pre></div>

<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/2.0.2/js/clipboard.min.js?1606080948"></script>
    <script src="/2.0.2/js/perfect-scrollbar.min.js?1606080948"></script>
    <script src="/2.0.2/js/perfect-scrollbar.jquery.min.js?1606080948"></script>
    <script src="/2.0.2/js/jquery.sticky.js?1606080948"></script>
    <script src="/2.0.2/js/featherlight.min.js?1606080948"></script>
    <script src="/2.0.2/js/highlight.pack.js?1606080948"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/2.0.2/js/modernizr.custom-3.6.0.js?1606080948"></script>
    <script src="/2.0.2/js/learn.js?1606080948"></script>
    <script src="/2.0.2/js/hugo-learn.js?1606080948"></script>

    <link href="/2.0.2/mermaid/mermaid.css?1606080948" rel="stylesheet" />
    <script src="/2.0.2/mermaid/mermaid.js?1606080948"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

